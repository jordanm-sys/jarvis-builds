<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Resume Tailor</title>
<style>
:root{--bg:#0d1117;--surface:#161b22;--surface2:#21262d;--border:#30363d;--text:#e6edf3;--text2:#8b949e;--accent:#58a6ff;--accent2:#3fb950;--danger:#f85149;--radius:8px}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;min-height:100vh}
.container{max-width:1200px;margin:0 auto;padding:20px}
header{display:flex;align-items:center;justify-content:space-between;padding:16px 0;border-bottom:1px solid var(--border);margin-bottom:24px;flex-wrap:wrap;gap:12px}
header h1{font-size:22px;display:flex;align-items:center;gap:8px}
.tabs{display:flex;gap:4px}
.tab{padding:8px 16px;border-radius:var(--radius);cursor:pointer;font-size:14px;color:var(--text2);background:transparent;border:1px solid transparent;transition:all .2s}
.tab:hover{color:var(--text);background:var(--surface)}
.tab.active{color:var(--text);background:var(--surface);border-color:var(--border)}
.panel{display:none}
.panel.active{display:block}
textarea,input[type="text"]{width:100%;padding:12px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);color:var(--text);font-size:14px;font-family:inherit;resize:vertical}
textarea:focus,input:focus{outline:none;border-color:var(--accent)}
label{display:block;font-size:13px;color:var(--text2);margin-bottom:6px;margin-top:16px}
label:first-child{margin-top:0}
.btn{padding:10px 20px;border:none;border-radius:var(--radius);cursor:pointer;font-size:14px;font-weight:600;transition:all .2s;display:inline-flex;align-items:center;gap:6px}
.btn-primary{background:var(--accent);color:#fff}
.btn-primary:hover{opacity:.9}
.btn-primary:disabled{opacity:.5;cursor:not-allowed}
.btn-success{background:var(--accent2);color:#fff}
.btn-success:hover{opacity:.9}
.btn-danger{background:var(--danger);color:#fff;font-size:12px;padding:6px 12px}
.btn-danger:hover{opacity:.9}
.btn-ghost{background:transparent;border:1px solid var(--border);color:var(--text2)}
.btn-ghost:hover{border-color:var(--text2);color:var(--text)}
.btn-row{display:flex;gap:8px;margin-top:20px;flex-wrap:wrap}
.status-badge{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;border-radius:20px;font-size:12px}
.status-badge.saved{background:#1a3a2a;color:var(--accent2)}
.status-badge.empty{background:#3a1a1a;color:var(--danger)}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:20px}
@media(max-width:768px){.grid-2{grid-template-columns:1fr}}
.result-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;margin-top:16px}
.result-card h3{font-size:16px;margin-bottom:12px;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.result-card .content{font-size:14px;line-height:1.7;white-space:pre-wrap;color:var(--text2)}
.keywords{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px}
.keyword{background:var(--surface2);padding:4px 10px;border-radius:20px;font-size:12px;color:var(--accent)}
.ats-score{font-size:48px;font-weight:700;text-align:center;padding:20px}
.ats-score.high{color:var(--accent2)}
.ats-score.mid{color:#d29922}
.ats-score.low{color:var(--danger)}
.tips{list-style:none;padding:0}
.tips li{padding:8px 0;font-size:13px;color:var(--text2);border-bottom:1px solid var(--border)}
.tips li:last-child{border:none}
.tips li::before{content:'üí° '}
.history-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:12px}
.history-card .meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
.history-card .meta h3{font-size:15px}
.history-card .meta span{font-size:12px;color:var(--text2)}
.history-card .meta-row{font-size:13px;color:var(--text2);margin-bottom:8px}
.loading-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:100;align-items:center;justify-content:center;flex-direction:column;gap:16px;color:var(--text)}
.loading-overlay.active{display:flex}
.spinner{display:inline-block;width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.empty-state{text-align:center;padding:60px 20px;color:var(--text2)}
.empty-state .icon{font-size:48px;margin-bottom:16px}
#resumePreview h1,#resumePreview h2,#resumePreview h3{color:var(--text);margin:12px 0 6px}
#resumePreview h1{font-size:20px;border-bottom:1px solid var(--border);padding-bottom:6px}
#resumePreview h2{font-size:17px;border-bottom:1px solid var(--border);padding-bottom:4px}
#resumePreview h3{font-size:15px}
#resumePreview p{margin:4px 0}
#resumePreview ul,#resumePreview ol{margin:4px 0 4px 20px}
#resumePreview li{margin:2px 0}
#resumePreview strong,#resumePreview b{color:var(--text)}
#resumePreview table{border-collapse:collapse;width:100%;margin:8px 0}
#resumePreview td,#resumePreview th{border:1px solid var(--border);padding:6px 10px;text-align:left}
.toast{position:fixed;bottom:20px;right:20px;padding:12px 20px;border-radius:var(--radius);color:#fff;font-size:14px;z-index:200;animation:fadeIn .3s}
.toast.success{background:var(--accent2)}
.toast.error{background:var(--danger)}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>üìÑ Resume Tailor</h1>
    <div class="tabs">
      <div class="tab active" data-tab="tailor">‚ú® Tailor</div>
      <div class="tab" data-tab="resume">üìã My Resume</div>
      <div class="tab" data-tab="history">üìÇ History</div>
    </div>
  </header>

  <!-- Tailor Panel -->
  <div class="panel active" id="panel-tailor">
    <div id="noResume" style="display:none">
      <div class="empty-state">
        <div class="icon">üìã</div>
        <h2>No resume saved yet</h2>
        <p style="margin-top:8px">Go to the "My Resume" tab and paste or upload your master resume first.</p>
      </div>
    </div>
    <div id="tailorForm">
      <div class="grid-2">
        <div>
          <label>Company Name (optional)</label>
          <input type="text" id="company" placeholder="e.g. Google, TD Bank, Shopify">
          <label>Role / Position (optional)</label>
          <input type="text" id="role" placeholder="e.g. Software Engineering Intern">
        </div>
        <div>
          <label>Job Posting *</label>
          <div style="display:flex;gap:8px;margin-bottom:8px;align-items:center">
            <button class="btn btn-ghost" id="jobUploadBtn">üìé Upload PDF/.docx/.txt</button>
            <input type="file" id="jobUpload" accept=".pdf,.docx,.txt" style="display:none">
            <span id="jobUploadStatus" style="font-size:13px;color:var(--text2)"></span>
          </div>
          <textarea id="jobPosting" rows="8" placeholder="Paste or upload the job description..."></textarea>
        </div>
      </div>
      <div class="btn-row">
        <button class="btn btn-primary" id="tailorBtn">‚ú® Tailor My Resume</button>
      </div>
    </div>

    <div id="results" style="display:none;margin-top:24px">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
        <h2>Results</h2>
        <div style="display:flex;gap:8px;align-items:center">
          <div id="atsInline" class="status-badge saved"></div>
          <button class="btn btn-ghost" id="closeResults">‚úï Close</button>
        </div>
      </div>
      <div class="grid-2">
        <div class="result-card">
          <h3>üìÑ Tailored Resume
            <button class="btn btn-ghost" style="margin-left:auto;font-size:12px;padding:4px 10px" onclick="copyText('resumeContent')">üìã Copy</button>
            <button class="btn btn-ghost" style="font-size:12px;padding:4px 10px" onclick="downloadDocx('resume')">‚¨á Word</button>
            <button class="btn btn-ghost" style="font-size:12px;padding:4px 10px" onclick="downloadPdf('resume')">‚¨á PDF</button>
          </h3>
          <div class="content" id="resumeContent"></div>
        </div>
        <div class="result-card">
          <h3>‚úâÔ∏è Cover Letter
            <button class="btn btn-ghost" style="margin-left:auto;font-size:12px;padding:4px 10px" onclick="copyText('coverContent')">üìã Copy</button>
            <button class="btn btn-ghost" style="font-size:12px;padding:4px 10px" onclick="downloadDocx('cover')">‚¨á Word</button>
            <button class="btn btn-ghost" style="font-size:12px;padding:4px 10px" onclick="downloadPdf('cover')">‚¨á PDF</button>
          </h3>
          <div class="content" id="coverContent"></div>
        </div>
      </div>
      <div class="grid-2" style="margin-top:0">
        <div class="result-card">
          <h3>üéØ ATS Score</h3>
          <div id="atsScore" class="ats-score"></div>
          <h3 style="margin-top:12px">üîë Keywords Matched</h3>
          <div id="keywordsMatched" class="keywords"></div>
        </div>
        <div class="result-card">
          <h3>üí° Tips</h3>
          <ul id="tipsList" class="tips"></ul>
        </div>
      </div>
      <div class="btn-row">
        <button class="btn btn-success" id="saveHistoryBtn">üíæ Save to History</button>
      </div>
    </div>
  </div>

  <!-- My Resume Panel -->
  <div class="panel" id="panel-resume">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
      <h2>Master Resume</h2>
      <div id="resumeStatus"></div>
    </div>
    <p style="font-size:13px;color:var(--text2);margin-bottom:16px">Upload your resume to preserve formatting, or paste plain text. This is the master copy GPT-4o will tailor for each job.</p>
    <div style="display:flex;gap:8px;margin-bottom:12px;align-items:center">
      <button class="btn btn-ghost" id="resumeUploadBtn">üìé Upload .docx / .pdf / .txt</button>
      <input type="file" id="resumeUpload" accept=".pdf,.docx,.txt" style="display:none">
      <span id="resumeUploadStatus" style="font-size:13px;color:var(--text2)"></span>
    </div>
    <!-- Formatted preview (shown when HTML available) -->
    <div id="resumePreview" style="display:none;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px;min-height:200px;max-height:600px;overflow-y:auto;font-size:14px;line-height:1.6;color:var(--text)"></div>
    <!-- Plain text fallback -->
    <textarea id="masterResume" rows="20" placeholder="Paste your full resume here..."></textarea>
    <input type="hidden" id="masterResumeHtml" value="">
    <div class="btn-row">
      <button class="btn btn-primary" id="saveResumeBtn">üíæ Save Resume</button>
      <button class="btn btn-ghost" id="editRawBtn" style="display:none">‚úèÔ∏è Edit Raw Text</button>
      <button class="btn btn-danger" id="clearResumeBtn">üóë Clear</button>
    </div>
  </div>

  <!-- History Panel -->
  <div class="panel" id="panel-history">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
      <h2>Tailoring History</h2>
      <span style="font-size:13px;color:var(--text2)" id="historyCount"></span>
    </div>
    <div id="historyList"></div>
  </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="spinner"></div>
  <p>GPT-4o is tailoring your resume...</p>
</div>

<script>
// --- State ---
let currentResult = null;

// --- Tabs ---
document.querySelectorAll('.tab').forEach(tab => {
  tab.addEventListener('click', () => switchTab(tab.dataset.tab));
});

function switchTab(name) {
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === name));
  document.querySelectorAll('.panel').forEach(p => p.classList.toggle('active', p.id === 'panel-' + name));
  if (name === 'resume') loadResume();
  if (name === 'history') loadHistory();
  if (name === 'tailor') checkResume();
}

// --- Toast ---
function toast(msg, type = 'success') {
  const el = document.createElement('div');
  el.className = 'toast ' + type;
  el.textContent = msg;
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 3000);
}

// --- Resume ---
async function loadResume() {
  try {
    const res = await fetch('/api/resume');
    const data = await res.json();
    document.getElementById('masterResume').value = data.resume || '';
    document.getElementById('masterResumeHtml').value = data.resumeHtml || '';
    showResumeView(data.resume, data.resumeHtml);
    updateResumeStatus(data.resume);
  } catch (e) {
    console.error(e);
  }
}

function showResumeView(text, html) {
  const preview = document.getElementById('resumePreview');
  const textarea = document.getElementById('masterResume');
  const editBtn = document.getElementById('editRawBtn');
  if (html && html.trim()) {
    preview.innerHTML = html;
    preview.style.display = 'block';
    textarea.style.display = 'none';
    editBtn.style.display = 'inline-flex';
  } else {
    preview.style.display = 'none';
    textarea.style.display = 'block';
    editBtn.style.display = 'none';
  }
}

function updateResumeStatus(text) {
  const el = document.getElementById('resumeStatus');
  if (text && text.trim()) {
    el.innerHTML = '<span class="status-badge saved">‚úÖ Saved</span>';
  } else {
    el.innerHTML = '<span class="status-badge empty">‚ö†Ô∏è Not set</span>';
  }
}

async function checkResume() {
  try {
    const res = await fetch('/api/resume');
    const data = await res.json();
    const hasResume = data.resume && data.resume.trim();
    document.getElementById('noResume').style.display = hasResume ? 'none' : 'block';
    document.getElementById('tailorForm').style.display = hasResume ? 'block' : 'none';
  } catch (e) {
    console.error(e);
  }
}

document.getElementById('saveResumeBtn').addEventListener('click', async () => {
  const resume = document.getElementById('masterResume').value;
  const resumeHtml = document.getElementById('masterResumeHtml').value;
  try {
    await fetch('/api/resume', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ resume, resumeHtml })
    });
    showResumeView(resume, resumeHtml);
    updateResumeStatus(resume);
    toast('Resume saved!');
  } catch (e) {
    toast('Error saving resume', 'error');
  }
});

document.getElementById('clearResumeBtn').addEventListener('click', () => {
  document.getElementById('masterResume').value = '';
  document.getElementById('masterResumeHtml').value = '';
  showResumeView('', '');
  toast('Cleared ‚Äî click Save to confirm', 'error');
});

document.getElementById('editRawBtn').addEventListener('click', () => {
  document.getElementById('resumePreview').style.display = 'none';
  document.getElementById('masterResume').style.display = 'block';
  document.getElementById('editRawBtn').style.display = 'none';
});

// --- File Uploads ---
async function uploadFile(fileInput, targetEl, statusEl, isResume) {
  const file = fileInput.files[0];
  if (!file) return;
  statusEl.textContent = 'Uploading...';
  const formData = new FormData();
  formData.append('file', file);
  try {
    const res = await fetch('/api/upload', { method: 'POST', body: formData });
    const data = await res.json();
    if (data.error) throw new Error(data.error);
    targetEl.value = data.text;
    if (isResume && data.html) {
      document.getElementById('masterResumeHtml').value = data.html;
      showResumeView(data.text, data.html);
    }
    statusEl.textContent = '‚úÖ ' + file.name;
    toast('File uploaded!');
  } catch (e) {
    statusEl.textContent = '‚ùå ' + e.message;
    toast('Upload failed: ' + e.message, 'error');
  }
  fileInput.value = '';
}

document.getElementById('resumeUploadBtn').addEventListener('click', () => {
  document.getElementById('resumeUpload').click();
});
document.getElementById('resumeUpload').addEventListener('change', function() {
  uploadFile(this, document.getElementById('masterResume'), document.getElementById('resumeUploadStatus'), true);
});

document.getElementById('jobUploadBtn').addEventListener('click', () => {
  document.getElementById('jobUpload').click();
});
document.getElementById('jobUpload').addEventListener('change', function() {
  uploadFile(this, document.getElementById('jobPosting'), document.getElementById('jobUploadStatus'), false);
});

// --- Tailor ---
document.getElementById('tailorBtn').addEventListener('click', tailorResume);

async function tailorResume() {
  const jobPosting = document.getElementById('jobPosting').value.trim();
  if (!jobPosting) { toast('Please enter a job posting', 'error'); return; }

  const btn = document.getElementById('tailorBtn');
  btn.disabled = true;
  document.getElementById('loadingOverlay').classList.add('active');

  try {
    const resumeRes = await fetch('/api/resume');
    const resumeData = await resumeRes.json();
    if (!resumeData.resume || !resumeData.resume.trim()) {
      toast('Save your resume first!', 'error');
      return;
    }

    const res = await fetch('/api/tailor', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        resume: resumeData.resume,
        jobPosting,
        company: document.getElementById('company').value.trim(),
        role: document.getElementById('role').value.trim()
      })
    });
    const data = await res.json();
    if (data.error) throw new Error(data.error);

    currentResult = {
      ...data,
      company: document.getElementById('company').value.trim(),
      role: document.getElementById('role').value.trim(),
      jobPosting
    };
    renderResults(data);
    document.getElementById('results').style.display = 'block';
    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
    toast('Resume tailored!');
  } catch (e) {
    toast('Error: ' + e.message, 'error');
  } finally {
    btn.disabled = false;
    document.getElementById('loadingOverlay').classList.remove('active');
  }
}

function renderResults(data) {
  document.getElementById('resumeContent').textContent = data.tailoredResume || '';
  document.getElementById('coverContent').textContent = data.coverLetter || '';

  const score = data.atsScore || 0;
  const scoreEl = document.getElementById('atsScore');
  scoreEl.textContent = score + '%';
  scoreEl.className = 'ats-score ' + (score >= 75 ? 'high' : score >= 50 ? 'mid' : 'low');

  const inlineEl = document.getElementById('atsInline');
  inlineEl.textContent = 'ATS: ' + score + '%';
  inlineEl.className = 'status-badge ' + (score >= 75 ? 'saved' : 'empty');

  const kwEl = document.getElementById('keywordsMatched');
  kwEl.innerHTML = (data.keywordsMatched || []).map(k => `<span class="keyword">${k}</span>`).join('');

  const tipsEl = document.getElementById('tipsList');
  tipsEl.innerHTML = (data.tips || []).map(t => `<li>${t}</li>`).join('');
}

document.getElementById('closeResults').addEventListener('click', () => {
  document.getElementById('results').style.display = 'none';
});

// --- Copy ---
function copyText(elId) {
  const text = document.getElementById(elId).textContent;
  navigator.clipboard.writeText(text).then(() => toast('Copied!')).catch(() => toast('Copy failed', 'error'));
}

// --- Downloads ---
async function downloadDocx(type) {
  if (!currentResult) return;
  const content = type === 'resume' ? currentResult.tailoredResume : currentResult.coverLetter;
  const filename = type === 'resume'
    ? `Resume_${currentResult.company || 'Tailored'}_${currentResult.role || ''}.docx`.replace(/\s+/g, '_')
    : `CoverLetter_${currentResult.company || 'Tailored'}_${currentResult.role || ''}.docx`.replace(/\s+/g, '_');
  try {
    const res = await fetch('/api/docx', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ content, filename, type })
    });
    const blob = await res.blob();
    downloadBlob(blob, filename);
    toast('Word doc downloaded!');
  } catch (e) {
    toast('Download failed: ' + e.message, 'error');
  }
}

async function downloadPdf(type) {
  if (!currentResult) return;
  const content = type === 'resume' ? currentResult.tailoredResume : currentResult.coverLetter;
  // Convert markdown-ish to HTML for PDF
  const html = markdownToHtml(content);
  const filename = type === 'resume'
    ? `Resume_${currentResult.company || 'Tailored'}_${currentResult.role || ''}.pdf`.replace(/\s+/g, '_')
    : `CoverLetter_${currentResult.company || 'Tailored'}_${currentResult.role || ''}.pdf`.replace(/\s+/g, '_');
  try {
    const res = await fetch('/api/pdf', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ content: html, filename, type })
    });
    const blob = await res.blob();
    downloadBlob(blob, filename);
    toast('PDF downloaded!');
  } catch (e) {
    toast('Download failed: ' + e.message, 'error');
  }
}

function markdownToHtml(md) {
  if (!md) return '';
  return md
    .replace(/^### (.+)$/gm, '<h3>$1</h3>')
    .replace(/^## (.+)$/gm, '<h2>$1</h2>')
    .replace(/^# (.+)$/gm, '<h1>$1</h1>')
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.+?)\*/g, '<em>$1</em>')
    .replace(/^- (.+)$/gm, '<li>$1</li>')
    .replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>')
    .replace(/<\/ul>\s*<ul>/g, '')
    .replace(/\n{2,}/g, '</p><p>')
    .replace(/\n/g, '<br>')
    .replace(/^/, '<p>')
    .replace(/$/, '</p>');
}

function downloadBlob(blob, filename) {
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = filename;
  document.body.appendChild(a); a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// --- History ---
document.getElementById('saveHistoryBtn').addEventListener('click', async () => {
  if (!currentResult) return;
  try {
    await fetch('/api/history', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(currentResult)
    });
    toast('Saved to history!');
  } catch (e) {
    toast('Error saving', 'error');
  }
});

async function loadHistory() {
  try {
    const res = await fetch('/api/history');
    const history = await res.json();
    const el = document.getElementById('historyList');
    document.getElementById('historyCount').textContent = history.length + ' entries';
    if (!history.length) {
      el.innerHTML = '<div class="empty-state"><div class="icon">üìÇ</div><h2>No history yet</h2><p style="margin-top:8px">Tailored resumes you save will appear here.</p></div>';
      return;
    }
    el.innerHTML = history.map(h => `
      <div class="history-card">
        <div class="meta">
          <h3>${h.company || 'Unknown'} ‚Äî ${h.role || 'Unknown'}</h3>
          <span>${new Date(h.createdAt).toLocaleDateString()} ${new Date(h.createdAt).toLocaleTimeString()}</span>
        </div>
        <div class="meta-row">ATS Score: <strong>${h.atsScore || '?'}%</strong> ¬∑ Keywords: ${(h.keywordsMatched || []).length}</div>
        <div class="btn-row" style="margin-top:8px">
          <button class="btn btn-ghost" style="font-size:12px;padding:4px 10px" onclick="viewHistory('${h.id}')">üëÅ View</button>
          <button class="btn btn-danger" onclick="deleteHistory('${h.id}')">üóë Delete</button>
        </div>
      </div>
    `).join('');
  } catch (e) {
    console.error(e);
  }
}

async function viewHistory(id) {
  try {
    const res = await fetch('/api/history');
    const history = await res.json();
    const entry = history.find(h => h.id === id);
    if (!entry) return;
    currentResult = entry;
    switchTab('tailor');
    document.getElementById('company').value = entry.company || '';
    document.getElementById('role').value = entry.role || '';
    document.getElementById('jobPosting').value = entry.jobPosting || '';
    renderResults(entry);
    document.getElementById('results').style.display = 'block';
    document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
  } catch (e) {
    toast('Error loading entry', 'error');
  }
}

async function deleteHistory(id) {
  if (!confirm('Delete this entry?')) return;
  try {
    await fetch('/api/history/' + id, { method: 'DELETE' });
    toast('Deleted!');
    loadHistory();
  } catch (e) {
    toast('Error deleting', 'error');
  }
}

// --- Init ---
checkResume();
</script>
</body>
</html>
